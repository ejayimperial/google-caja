#summary Proposed new code review scheme.

= Introduction =

Here's how to do code reviews without using gvn.

= Details =

1. `svn checkout https://google-caja.googlecode.com/svn/trunk google-caja/trunk`

2. `svn checkout https://google-caja.googlecode.com/svn/branches google-caja/branches`

The point of these steps is to get /trunk and /branches in the same
checkout without having to get all of /changes, which is
huge.

2. `cd google-caja`

3. `svn copy trunk branches/<username>-<branchname>`

4. `cd branches/<username>-<branchname>`

5. `svn ci`

This establishes the point at which the branch was taken.

6. <do some work>

7. `svn ci`

8. Go to `http://code.google.com/p/google-caja/source/checkout` and
choose "Request code review".

9. Fill in the details and submit the issue.

10. Make changes in response to feedback.

11. `svn ci`

12. Go to 9.

Once the change is accepted, merge it back into the trunk. svn merge
is dumb, so you have to jump through some hoops to do this...

13. (in the branch) `svn log --stop-on-copy --verbose`

You'll see something like:

   `A /branches/ben-review-test (from /trunk:2839)`

The revision shown is the revision at which the branch occurred. Call
it X.

14. `cd .../trunk`

15.  `svn update`

You'll see "At revision Y". This is the current head...

16. `svn merge -r X:Y .../branches/<username>-<branchname>`

17. `svn ci`

18. `svn delete .../branches/<username>-<branchname>`

19. `cd .../branches`

20. `svn ci`

21. Close the issue (note that if you have deleted the branch, you
will also need to change that in the issue - just "/branches" works).

N.B.: If you merge from the head into the branch, then you need to
keep track of your new common ancestor (e.g. by mentioning it in the
log entry when you check in). Subversion sucks!

Also note that many of these commands can be performed at the repo
instead of locally. Feel free to document those variants.

In particular the branch operation can be done like this [UNTESTED -
remove this and/or correct if you test]:

`svn copy https://google-caja.googlecode.com/svn/trunk https://google-caja.googlecode.com/svn/branches/<username>-<branchname>`

and then check out the branch in the usual way.
